@if (isPlaylistOpen()) {
  <app-player-playlist
    [nextSongs]="nextSongs()"
    (closePlaylist)="closePlaylist()"
  />
}
<div
  class="z-10 flex h-20 w-full flex-row flex-nowrap justify-center border-t border-slate-200 bg-slate-100 shadow-md"
>
  <div
    class="flex h-full grow flex-row flex-nowrap items-center gap-3 px-4"
    style="max-width: 1200px"
  >
    @if (currentSong(); as song) {
      <img
        [src]="currentSongImgUrl()"
        alt="Album art"
        class="h-16 w-16 rounded object-contain shadow-sm"
      />
      <div
        class="line flex grow flex-col flex-nowrap px-2 py-1 leading-5 text-gray-800"
      >
        <div class="truncate font-medium">{{ song.title }}</div>
        @if (currentSongAlbum$ | async; as album) {
          <div class="truncate">
            <small class="text-gray-600">
              {{ album.albumArtist }} /
              <span class="font-bold">{{ album.album }}</span>
            </small>
          </div>
          <div class="text-gray-500">
            <small>[{{ album.year }}]</small>&nbsp;
            <small>{{ album.genres.join(", ") }}</small>
          </div>
        }
      </div>

      <!-- Audio Player Controls - Clearly delimited -->
      <div
        class="audio-player-controls flex items-center gap-3 rounded-lg border border-gray-200 bg-white px-4 py-2 shadow-sm"
      >
        <!-- Play/Pause and Next buttons -->
        <div class="flex items-center gap-2">
          <button
            class="btn rounded-full bg-emerald-600 p-2.5 text-white transition-all hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-600 focus:ring-offset-2"
            attr.aria-label="{{ isPlaying ? 'Pause' : 'Play' }}"
            (click)="togglePlayPause()"
          >
            @if (isPlaying) {
              <app-icon-cancel class="size-4" />
            } @else {
              <app-icon-play class="size-4" />
            }
          </button>

          <button
            class="btn rounded-full bg-gray-200 p-2 text-gray-700 transition-all hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-emerald-600 focus:ring-offset-2"
            aria-label="Next song"
            (click)="goToNextSong()"
          >
            <app-icon-play-next class="size-4" />
          </button>
        </div>

        <!-- Progress section -->
        <div class="flex w-48 flex-col gap-1">
          <!-- Progress bar -->
          <div
            class="relative h-2 w-full cursor-pointer rounded-full bg-gray-200"
            (click)="seek($event)"
            #progressContainer
          >
            <div
              class="absolute left-0 top-0 h-full rounded-full bg-emerald-500"
              [style.width.%]="(currentTime / duration) * 100"
            ></div>
          </div>

          <!-- Time indicators -->
          <div class="flex justify-between text-xs font-medium text-gray-500">
            <span>{{ formatTime(currentTime) }}</span>
            <span>{{ formatTime(duration) }}</span>
          </div>
        </div>

        <!-- Volume control -->
        <div class="flex items-center gap-1">
          <button
            class="p-1 text-gray-600 hover:text-emerald-600 focus:text-emerald-600 focus:outline-none"
            (click)="toggleMute()"
            aria-label="Toggle mute"
          >
            <!-- TODO: Replace with proper mute/volume icon -->
            <app-icon-eye class="size-4" />
          </button>
          <input
            type="range"
            min="0"
            max="1"
            step="0.05"
            [value]="volume"
            (input)="setVolume($event)"
            class="h-1.5 w-16 cursor-pointer appearance-none rounded-full bg-gray-200 accent-emerald-500 focus:outline-none focus:ring-1 focus:ring-emerald-500"
            aria-label="Volume"
          />
        </div>
      </div>

      <audio
        #audioElement
        (ended)="goToNextSong()"
        [autoplay]="true"
        [src]="currentSongAudioUrl()"
        type="audio/*"
        (timeupdate)="updateProgress()"
        (loadedmetadata)="onMetadataLoaded()"
        hidden
      >
        Your browser does not support the
        <code>audio</code> element.
      </audio>

      <button
        class="btn ml-2 rounded-full bg-gray-200 p-2 text-gray-700 transition-all hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-emerald-600 focus:ring-offset-2"
        aria-label="Toggle playlist"
        (click)="togglePlaylist()"
      >
        @if (isPlaylistOpen()) {
          <app-icon-chevron-down class="size-5" />
        } @else {
          <app-icon-chevron-up class="size-5" />
        }
      </button>
    } @else {
      <div class="grow self-center text-center text-gray-500">
        &lt;No songs in playlist&gt;
      </div>
    }
  </div>
</div>
